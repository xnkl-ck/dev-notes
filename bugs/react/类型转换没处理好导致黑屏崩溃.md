è¿™é‡Œä¸ºæ‚¨æ•´ç†å¥½çš„ Markdown æ ¼å¼æŠ€æœ¯æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥ç›´æ¥ç”¨äºå›¢é˜ŸçŸ¥è¯†åº“æˆ–ä»£ç æ³¨é‡Šæ–‡æ¡£ä¸­ã€‚

-----

# `cleanHtmlText` å‡½æ•°æœ€ä½³å®è·µå¤ç›˜

æœ¬æ–‡æ¡£åˆ†æäº† `cleanHtmlText` å‡½æ•°åœ¨è¿­ä»£è¿‡ç¨‹ä¸­çš„ä¸‰ç§å®ç°æ–¹å¼ï¼Œè§£æäº†å¯¼è‡´ React ç»„ä»¶å´©æºƒï¼ˆé»‘å±ï¼‰çš„æ ¹æœ¬åŸå› ï¼Œå¹¶ç»™å‡ºäº†åŸºäºé˜²å¾¡æ€§ç¼–ç¨‹çš„æœ€ä½³å®è·µæ–¹æ¡ˆã€‚

## 1\. é—®é¢˜ç°åœºï¼šä¸ºä½•ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼ˆé»‘å±ï¼‰ï¼Ÿ

**ä»£ç å®ç° (ç¬¬ä¸€ç‰ˆ)ï¼š**

```javascript
const cleanHtmlText = (text) => {
    if (!text) return '';
    // ğŸ’€ è‡´å‘½é”™è¯¯ç‚¹
    return text.replace(/<[^>]*>/g, '').trim();
};
```

  * **åœºæ™¯è¿˜åŸ**ï¼šå½“å‡½æ•°ä¼ å…¥å¸ƒå°”å€¼ï¼ˆå¦‚ `true` æˆ– `false`ï¼‰æ—¶ã€‚
  * **æ ¹æœ¬åŸå› **ï¼šåœ¨ JavaScript ä¸­ï¼Œ**å¸ƒå°”å€¼ï¼ˆBooleanï¼‰æ²¡æœ‰ `.replace()` æ–¹æ³•**ï¼Œåªæœ‰å­—ç¬¦ä¸²ï¼ˆStringï¼‰æ‰æœ‰ã€‚
  * **æ‰§è¡Œåæœ**ï¼š
    1.  JS å¼•æ“æŠ›å‡º `Uncaught TypeError: text.replace is not a function`ã€‚
    2.  ç”±äºè¯¥é”™è¯¯æœªè¢«æ•è·ï¼ŒReact ç»„ä»¶æ ‘åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å´©æºƒã€‚
    3.  React ä¸ºä¿æŠ¤ UI çŠ¶æ€å¸è½½æ•´ä¸ªç»„ä»¶ï¼Œå¯¼è‡´é¡µé¢è¡¨ç°ä¸º\*\*â€œé»‘å±â€æˆ–ç™½å±\*\*ã€‚

-----

## 2\. ä¸´æ—¶æ–¹æ¡ˆï¼šä¸ºä½• `try-catch` ä¸æ˜¯æœ€ä¼˜è§£ï¼Ÿ

**ä»£ç å®ç° (ç¬¬äºŒç‰ˆ)ï¼š**

```javascript
const cleanHtmlText = (text) => {
    if (!text) return '';
    try {
        return text.replace(/<[^>]*>/g, '').trim()
    } catch (error) {
        // ğŸš‘ æ©ç›–å¼ä¿®å¤
        return text
    }
};
```

  * **åˆ†æ**ï¼šè™½ç„¶é€šè¿‡ `catch` æ•è·äº†é”™è¯¯é˜»æ­¢äº†å´©æºƒï¼Œä½†å¼•å…¥äº†æ›´æ·±å±‚çš„éšæ‚£ï¼ˆDirty Dataï¼‰ã€‚
  * **ç¼ºé™·**ï¼š
    1.  **è¿”å›ç±»å‹ä¸ä¸€è‡´**ï¼šä¼ å…¥å­—ç¬¦ä¸²æ—¶è¿”å› `String`ï¼Œä¼ å…¥å¸ƒå°”å€¼æ—¶è¿”å› `Boolean`ã€‚è¿™ç§**ä¸å¯é¢„æµ‹çš„è¿”å›ç±»å‹**ä¼šç»™åç»­è°ƒç”¨æ­¤å‡½æ•°çš„ä»£ç åŸ‹ä¸‹ Bugã€‚
    2.  **æ©è€³ç›—é“ƒ**ï¼šè¿™é‡Œçš„é—®é¢˜æœ¬è´¨æ˜¯**æ•°æ®ç±»å‹é”™è¯¯**ï¼Œåº”è¯¥ä¿®æ­£ç±»å‹ï¼Œè€Œä¸æ˜¯å½“ä½œâ€œæ„å¤–å¼‚å¸¸â€æ¥æ•è·ã€‚

-----

## 3\. æœ€ä½³å®è·µï¼šæ˜¾å¼ç±»å‹è½¬æ¢

**ä»£ç å®ç° (æœ€ç»ˆç‰ˆ)ï¼š**

```javascript
const cleanHtmlText = (text) => {
    // 1. é˜²å¾¡æ€§ç¼–ç¨‹ï¼šå¤„ç† null å’Œ undefined
    if (text == null) return ''; 
    
    // 2. æ˜¾å¼ç±»å‹è½¬æ¢ (Core)
    // æ— è®º text æ˜¯ true, 123, è¿˜æ˜¯å¯¹è±¡ï¼ŒString(text) éƒ½ä¼šå°†å…¶è½¬ä¸ºå­—ç¬¦ä¸²
    const str = String(text); 
    
    // 3. å®‰å…¨è°ƒç”¨
    return str.replace(/<[^>]*>/g, '').trim();
};
```

  * **å¥å£®æ€§ (Robustness)**ï¼šé€šè¿‡ `String(text)` è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œå³ä½¿æ„å¤–ä¼ å…¥æ•°å­— `123` æˆ–å¸ƒå°”å€¼ `true`ï¼Œä»£ç ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šæŠ¥é”™ã€‚
  * **ä¸€è‡´æ€§ (Consistency)**ï¼šä¿è¯å‡½æ•°çš„è¿”å›å€¼æ°¸è¿œæ˜¯ **String** ç±»å‹ï¼Œç»´æŠ¤äº†ä»£ç å¥‘çº¦ã€‚
  * **å¯è¯»æ€§**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ„å›¾æ˜ç¡®ã€‚

**æ›´ç²¾ç®€çš„ ES6 å†™æ³•ï¼š**

```javascript
const cleanHtmlText = (text) => {
    // åˆ©ç”¨ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦å¤„ç† null/undefinedï¼Œå¹¶å¼ºåˆ¶è½¬ä¸º String
    const str = String(text ?? ''); 
    return str.replace(/<[^>]*>/g, '').trim();
};
```

-----

## æ€»ç»“

| ç»´åº¦ | è¯´æ˜ |
| :--- | :--- |
| **æ ¹å›  (Root Cause)** | ä¼ å…¥çš„å‚æ•°ä¸ºå¸ƒå°”å€¼ (Boolean)ï¼Œæ— æ³•è°ƒç”¨ä»…å±äºå­—ç¬¦ä¸²çš„ `.replace` æ–¹æ³•ã€‚ |
| **ç°è±¡ (Symptom)** | JS æŠ›å‡º `TypeError`ï¼Œå¯¼è‡´ React ç»„ä»¶æ¸²æŸ“ä¸­æ–­å¹¶å¸è½½ï¼Œé¡µé¢é»‘å±ã€‚ |
| **é™·é˜± (Pitfall)** | ä½¿ç”¨ `try-catch` è™½ç„¶é¿å…äº†é»‘å±ï¼Œä½†å¯¼è‡´å‡½æ•°è¿”å›ç±»å‹æ··ä¹±ï¼ˆBoolean/String æ··æ‚ï¼‰ï¼ŒåŸ‹ä¸‹éšæ‚£ã€‚ |
| **è§£å†³æ–¹æ¡ˆ (Solution)** | **ä½¿ç”¨ `String(text)` è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢**ã€‚ç¡®ä¿åœ¨è°ƒç”¨æ–¹æ³•å‰ï¼Œæ•°æ®ç±»å‹ 100% ä¸ºå­—ç¬¦ä¸²ã€‚ |