# åªè¯»æ¨¡å¼å®ç°æœ€ä½³å®è·µæŒ‡å—

> åŸºäºå·²å‘å¸ƒAgentåªè¯»ä¿æŠ¤åŠŸèƒ½çš„å®æˆ˜ç»éªŒæ€»ç»“

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [æ ¸å¿ƒæ€è·¯](#æ ¸å¿ƒæ€è·¯)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [å…³é”®å®ç°](#å…³é”®å®ç°)
- [è®¾è®¡å†³ç­–](#è®¾è®¡å†³ç­–)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## åŠŸèƒ½æ¦‚è¿°

### ä¸šåŠ¡åœºæ™¯
å½“Agentå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒåï¼ˆ`versionType === 'PUBLISH'`ï¼‰ï¼Œéœ€è¦é˜²æ­¢ç”¨æˆ·è¯¯æ“ä½œä¿®æ”¹ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§ã€‚

### æ ¸å¿ƒè¦æ±‚
1. âœ… ç¦æ­¢æ‰€æœ‰ç¼–è¾‘æ“ä½œï¼ˆæ‹–æ‹½ã€è¿æ¥ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰
2. âœ… å…è®¸æŸ¥çœ‹å’Œå¤åˆ¶ï¼ˆåˆç†çš„åªè¯»æ“ä½œï¼‰
3. âœ… æ¸…æ™°çš„è§†è§‰æç¤ºï¼ˆè®©ç”¨æˆ·çŸ¥é“æ˜¯åªè¯»çŠ¶æ€ï¼‰
4. âœ… ç®€æ´çš„ç”¨æˆ·ä½“éªŒï¼ˆä¸æ˜¾ç¤ºä¸å¯ç”¨çš„åŠŸèƒ½ï¼‰

---

## æ ¸å¿ƒæ€è·¯

### ğŸ¯ ä¸‰å±‚é˜²æŠ¤ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1å±‚ï¼šçŠ¶æ€åˆ¤æ–­                        â”‚
â”‚  const isPublishedVersion =            â”‚
â”‚    chatflow?.versionType === 'PUBLISH' â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2å±‚ï¼šUIæ‹¦æˆª                          â”‚
â”‚  â€¢ éšè—ç¼–è¾‘æŒ‰é’®                         â”‚
â”‚  â€¢ æ“ä½œæ—¶æ˜¾ç¤ºæç¤º                       â”‚
â”‚  â€¢ æ·»åŠ è§†è§‰æ ‡è¯†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3å±‚ï¼šåº•å±‚ç¦ç”¨                        â”‚
â”‚  â€¢ nodesDraggable={false}              â”‚
â”‚  â€¢ nodesConnectable={false}            â”‚
â”‚  â€¢ deleteKeyCode={null}                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸‰å±‚ï¼Ÿ**
- ç¬¬1å±‚ï¼šæä¾›ç»Ÿä¸€çš„åˆ¤æ–­é€»è¾‘
- ç¬¬2å±‚ï¼šæä¾›å‹å¥½çš„ç”¨æˆ·ä½“éªŒ
- ç¬¬3å±‚ï¼šç¡®ä¿å®‰å…¨æ€§å…œåº•

---

## æ¶æ„è®¾è®¡

### 1. çŠ¶æ€ç®¡ç† - Reduxå•ä¸€æ•°æ®æº

```javascript
// âœ… æœ€ä½³å®è·µï¼šä»Reduxè·å–çŠ¶æ€
const chatflow = useSelector((state) => state.canvas.chatflow)
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‰æ‹© |
|------|------|------|------|
| Propsä¼ é€’ | æ˜ç¡® | å±‚çº§æ·±æ—¶ç¹ç | âŒ |
| Context | å…¨å±€å…±äº« | éœ€è¦ProvideråŒ…è£¹ | âŒ |
| Redux | ç»Ÿä¸€ç®¡ç† | éœ€è¦ReduxåŸºç¡€ | âœ… |

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰
- âœ… çŠ¶æ€é›†ä¸­ç®¡ç†
- âœ… é¿å…çŠ¶æ€ä¸ä¸€è‡´

### 2. ä¿æŠ¤èŒƒå›´ - å…¨é¢è¦†ç›–ç¼–è¾‘å…¥å£

```
ç”»å¸ƒæ“ä½œ                     èŠ‚ç‚¹æ“ä½œ
â”œâ”€ æ‹–æ‹½èŠ‚ç‚¹ âœ“               â”œâ”€ å³é”®èœå• âœ“
â”œâ”€ è¿æ¥èŠ‚ç‚¹ âœ“               â”‚  â”œâ”€ å¤åˆ¶ï¼ˆéšè—ï¼‰
â”œâ”€ æ·»åŠ èŠ‚ç‚¹ âœ“               â”‚  â””â”€ åˆ é™¤ï¼ˆéšè—ï¼‰
â”œâ”€ åˆ é™¤èŠ‚ç‚¹ âœ“               â”œâ”€ åŒå‡»ç¼–è¾‘ âœ“
â””â”€ ä¿®æ”¹è¿æ¥ âœ“               â””â”€ å‚æ•°ä¿®æ”¹ âœ“

å·¥å…·æ                        è§†è§‰æç¤º
â”œâ”€ ä¿å­˜æŒ‰é’®ï¼ˆéšè—ï¼‰          â”œâ”€ é”å›¾æ ‡ âœ“
â”œâ”€ åˆ é™¤æŒ‰é’®ï¼ˆéšè—ï¼‰          â””â”€ éšè—ä¾§è¾¹æ  âœ“
â”œâ”€ å­˜æ¡£æŒ‰é’®ï¼ˆéšè—ï¼‰
â””â”€ å‘å¸ƒæŒ‰é’®ï¼ˆéšè—ï¼‰
```

---

## å…³é”®å®ç°

### 1. ç”»å¸ƒå±‚ä¿æŠ¤

```javascript
// Canvas.jsx
const AgentflowCanvas = () => {
    const chatflow = useSelector((state) => state.canvas.chatflow)
    const isPublishedVersion = chatflow?.versionType === 'PUBLISH'

    // âœ… å…³é”®1: æ¸…é™¤dirtyçŠ¶æ€ï¼ˆé˜²æ­¢è¯¯å¯¼ï¼‰
    useEffect(() => {
        if (isPublishedVersion && canvasDataStore.isDirty) {
            dispatch({ type: REMOVE_DIRTY })
        }
    }, [isPublishedVersion, canvasDataStore.isDirty, dispatch])

    // âœ… å…³é”®2: æ“ä½œæ‹¦æˆª + å‹å¥½æç¤º
    const onConnect = (params) => {
        if (isPublishedVersion) {
            enqueueSnackbar({
                message: t('messages.publishedVersionReadOnly'),
                options: { variant: 'warning' }
            })
            return  // æå‰è¿”å›ï¼Œé˜»æ­¢åç»­é€»è¾‘
        }
        // ... æ­£å¸¸è¿æ¥é€»è¾‘
    }

    // âœ… å…³é”®3: ReactFlowåº•å±‚ç¦ç”¨
    return (
        <ReactFlow
            nodesDraggable={!isPublishedVersion}
            nodesConnectable={!isPublishedVersion}
            deleteKeyCode={isPublishedVersion ? null : ['Delete', 'Backspace']}
            elementsSelectable={true}  // ä»å…è®¸é€‰ä¸­æŸ¥çœ‹
        />
    )
}
```

**å®ç°è¦ç‚¹ï¼š**
1. **å¤šå±‚é˜²æŠ¤**ï¼šUIæ‹¦æˆª + åº•å±‚ç¦ç”¨
2. **ç”¨æˆ·å‹å¥½**ï¼šæç¤ºåŸå› è€Œéé™é»˜å¤±è´¥
3. **çŠ¶æ€åŒæ­¥**ï¼šè‡ªåŠ¨æ¸…é™¤dirtyé¿å…è¯¯å¯¼

### 2. èŠ‚ç‚¹èœå•ä¿æŠ¤

```javascript
// AgentFlowNode.jsx / IterationNode.jsx / StickyNote.jsx
const AgentFlowNode = ({ data }) => {
    const chatflow = useSelector((state) => state.canvas.chatflow)
    const isPublishedVersion = chatflow?.versionType === 'PUBLISH'

    return (
        <MenuList>
            {/* âœ… å…³é”®ï¼šæ¡ä»¶æ¸²æŸ“è€Œéç¦ç”¨ */}
            {!isPublishedVersion && (
                <MenuItem onClick={() => duplicateNode(data.id)}>
                    å¤åˆ¶
                </MenuItem>
            )}
            
            {!isPublishedVersion && (
                <MenuItem onClick={() => deleteNode(data.id)}>
                    åˆ é™¤
                </MenuItem>
            )}
            
            {/* âœ… ä¿¡æ¯æŒ‰é’®å§‹ç»ˆæ˜¾ç¤º */}
            <MenuItem onClick={() => setShowInfoDialog(true)}>
                ä¿¡æ¯
            </MenuItem>
        </MenuList>
    )
}
```

**ä¸ºä»€ä¹ˆç”¨æ¡ä»¶æ¸²æŸ“è€Œédisabledï¼Ÿ**

```javascript
// âŒ æ–¹æ¡ˆAï¼šç¦ç”¨çŠ¶æ€ï¼ˆä¸æ¨èï¼‰
<MenuItem 
    disabled={isPublishedVersion}
    onClick={...}
    sx={{
        opacity: isPublishedVersion ? 0.5 : 1,
        cursor: isPublishedVersion ? 'not-allowed' : 'pointer',
        // ... æ›´å¤šæ ·å¼å¤„ç†
    }}
>
    åˆ é™¤
</MenuItem>

// âœ… æ–¹æ¡ˆBï¼šæ¡ä»¶æ¸²æŸ“ï¼ˆæ¨èï¼‰
{!isPublishedVersion && (
    <MenuItem onClick={...}>
        åˆ é™¤
    </MenuItem>
)}
```

**å¯¹æ¯”åˆ†æï¼š**

| ç»´åº¦ | disabledæ–¹æ¡ˆ | æ¡ä»¶æ¸²æŸ“æ–¹æ¡ˆ |
|------|-------------|-------------|
| ä»£ç é‡ | å¤šï¼ˆéœ€å¤„ç†æ ·å¼ï¼‰ | å°‘ |
| ç”¨æˆ·ä½“éªŒ | æ··æ·†ï¼ˆä¸ºä»€ä¹ˆæ˜¾ç¤ºç°è‰²ï¼Ÿï¼‰ | æ¸…æ™°ï¼ˆä¸æ˜¾ç¤ºå°±æ˜¯ä¸èƒ½ç”¨ï¼‰ |
| ç»´æŠ¤æ€§ | å¤æ‚ | ç®€å• |
| è§†è§‰å¹²æ‰° | æœ‰ï¼ˆç°è‰²æŒ‰é’®ï¼‰ | æ—  |

### 3. é¡¶éƒ¨å·¥å…·æ ä¿æŠ¤

```javascript
// CanvasHeader.jsx
const CanvasHeader = ({ chatflow, isPublishedVersion }) => {
    return (
        <>
            <Typography>
                {flowName}
            </Typography>
            
            {/* âœ… ç®€æ´çš„è§†è§‰æç¤º */}
            {isPublishedVersion && (
                <Box sx={{ display: 'flex', alignItems: 'center' }}>
                    <Lock 
                        size={14} 
                        strokeWidth={2} 
                        color={theme.palette.primary.main}  // è‡ªé€‚åº”ä¸»é¢˜
                    />
                </Box>
            )}

            {/* âœ… æ¡ä»¶æ¸²æŸ“ç¼–è¾‘æŒ‰é’® */}
            {handleSaveFlow && (
                <Button onClick={onSaveChatflowClick}>ä¿å­˜</Button>
            )}
            
            {onPublishDraft && (
                <Button onClick={onPublishDraft}>å‘å¸ƒ</Button>
            )}
        </>
    )
}
```

**è§†è§‰è®¾è®¡æ¼”è¿›ï¼š**

```
V1: å¤æ‚ç‰ˆæœ¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ åªè¯»             â”‚  èƒŒæ™¯è‰² + è¾¹æ¡† + æ–‡å­—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

V2: ç®€åŒ–ç‰ˆæœ¬
ğŸ”’ åªè¯»                  å»æ‰èƒŒæ™¯å’Œè¾¹æ¡†

V3: æç®€ç‰ˆæœ¬ âœ…
ğŸ”’                      åªä¿ç•™å›¾æ ‡
```

**è®¾è®¡åŸåˆ™ï¼šLess is More**
- âœ… æç®€è®¾è®¡ï¼Œä¸€ä¸ªå›¾æ ‡èƒœè¿‡åƒè¨€ä¸‡è¯­
- âœ… ä½¿ç”¨ä¸»é¢˜è‰²ï¼Œè‡ªåŠ¨é€‚é…æ˜æš—æ¨¡å¼
- âœ… ä½ç½®åˆç†ï¼Œç´§è·ŸAgentåç§°

### 4. ç¼–è¾‘å¯¹è¯æ¡†ä¿æŠ¤

```javascript
// EditNodeDialog.jsx
const EditNodeDialog = ({ dialogProps }) => {
    const [isReadOnly, setIsReadOnly] = useState(false)

    useEffect(() => {
        if (dialogProps.isReadOnly) {
            setIsReadOnly(true)
        }
    }, [dialogProps])

    return (
        <>
            {/* âœ… éšè—åç§°ç¼–è¾‘æŒ‰é’® */}
            {data?.id && !isReadOnly && (
                <IconButton onClick={() => setEditingNodeName(true)}>
                    <IconPencil />
                </IconButton>
            )}

            {/* âœ… ç¦ç”¨æ‰€æœ‰è¾“å…¥ */}
            <NodeInputHandler
                disabled={dialogProps.disabled || isReadOnly}
                inputParam={inputParam}
                data={data}
            />
        </>
    )
}
```

---

## è®¾è®¡å†³ç­–

### å†³ç­–1: å¤åˆ¶æŒ‰é’®æ˜¯å¦ä¿ç•™ï¼Ÿ

```
âŒ åˆå§‹æ–¹æ¡ˆï¼šä¿ç•™å¤åˆ¶ï¼Œç¦ç”¨åˆ é™¤
   ç†ç”±ï¼šç”¨æˆ·å¯èƒ½éœ€è¦å¤åˆ¶å·²å‘å¸ƒç‰ˆæœ¬
   é—®é¢˜ï¼šUIä¸ä¸€è‡´ï¼Œç”¨æˆ·å›°æƒ‘

âœ… æœ€ç»ˆæ–¹æ¡ˆï¼šéƒ½éšè—
   ç†ç”±ï¼šå·²å‘å¸ƒç‰ˆæœ¬åº”å®Œå…¨åªè¯»
   ä¼˜åŠ¿ï¼šUIæ¸…æ™°ï¼Œæ¦‚å¿µç»Ÿä¸€
```

### å†³ç­–2: æç¤ºæ–¹å¼ï¼Ÿ

```
âŒ æ–¹æ¡ˆAï¼šç‚¹å‡»åå¼¹çª—æç¤º
   é—®é¢˜ï¼šéœ€è¦äº¤äº’æ‰çŸ¥é“ï¼Œä½“éªŒå·®

âŒ æ–¹æ¡ˆBï¼šTooltipæ‚¬åœæç¤º
   é—®é¢˜ï¼šä¾ç„¶éœ€è¦ç”¨æˆ·å°è¯•

âœ… æ–¹æ¡ˆCï¼šç›´æ¥éšè— + é¡¶éƒ¨é”å›¾æ ‡
   ä¼˜åŠ¿ï¼šä¸€çœ¼å°±çŸ¥é“æ˜¯åªè¯»
```

### å†³ç­–3: ä¾§è¾¹æ æ˜¯å¦æ˜¾ç¤ºï¼Ÿ

```
âŒ ä¿ç•™ä¾§è¾¹æ ï¼š
   - å ç”¨å±å¹•ç©ºé—´
   - è¯±å¯¼ç”¨æˆ·å°è¯•æ·»åŠ èŠ‚ç‚¹

âœ… éšè—ä¾§è¾¹æ ï¼š
   - èŠ‚çœç©ºé—´
   - å¼ºåŒ–åªè¯»æ¦‚å¿µ
   - è‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå®½åº¦
```

### å†³ç­–4: ä¿¡æ¯æŒ‰é’®æ˜¯å¦ä¿ç•™ï¼Ÿ

```
âœ… ä¿ç•™ä¿¡æ¯æŒ‰é’®ï¼š
   - æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…æ˜¯åˆç†éœ€æ±‚
   - äº†è§£é…ç½®ä¿¡æ¯
   - ä¸æ¶‰åŠä¿®æ”¹æ“ä½œ
```

---

## ä»£ç ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ï¼šèŠ‚ç‚¹å³é”®èœå•

```javascript
import { useSelector } from 'react-redux'
import { MenuItem, MenuList } from '@mui/material'

const NodeContextMenu = ({ data, onClose }) => {
    // 1. è·å–çŠ¶æ€
    const chatflow = useSelector((state) => state.canvas.chatflow)
    const isPublishedVersion = chatflow?.versionType === 'PUBLISH'
    
    // 2. è·å–æ“ä½œå‡½æ•°
    const { deleteNode, duplicateNode } = useContext(flowContext)
    
    // 3. æ¸²æŸ“èœå•
    return (
        <MenuList sx={{ py: 0, px: 0 }}>
            {/* æ¡ä»¶æ¸²æŸ“ç¼–è¾‘åŠŸèƒ½ */}
            {!isPublishedVersion && (
                <MenuItem 
                    onClick={() => {
                        duplicateNode(data.id)
                        onClose()
                    }}
                    sx={{
                        '&:hover': {
                            backgroundColor: theme.palette.background.border
                        }
                    }}
                >
                    å¤åˆ¶
                </MenuItem>
            )}
            
            {!isPublishedVersion && (
                <MenuItem 
                    onClick={() => {
                        deleteNode(data.id)
                        onClose()
                    }}
                    sx={{
                        '&:hover': {
                            backgroundColor: theme.palette.background.border
                        }
                    }}
                >
                    åˆ é™¤
                </MenuItem>
            )}
            
            {/* æŸ¥çœ‹åŠŸèƒ½å§‹ç»ˆå¯ç”¨ */}
            <MenuItem 
                onClick={() => {
                    setShowInfoDialog(true)
                    onClose()
                }}
                sx={{
                    '&:hover': {
                        backgroundColor: theme.palette.background.border
                    }
                }}
            >
                ä¿¡æ¯
            </MenuItem>
        </MenuList>
    )
}
```

### å®Œæ•´ç¤ºä¾‹ï¼šç”»å¸ƒæ“ä½œæ‹¦æˆª

```javascript
const Canvas = () => {
    // 1. çŠ¶æ€è·å–
    const chatflow = useSelector((state) => state.canvas.chatflow)
    const isPublishedVersion = chatflow?.versionType === 'PUBLISH'
    const { t } = useI18n()
    const dispatch = useDispatch()
    
    // 2. æ“ä½œæ‹¦æˆª
    const onConnect = useCallback((params) => {
        // å·²å‘å¸ƒç‰ˆæœ¬ï¼šæ˜¾ç¤ºæç¤ºå¹¶é˜»æ­¢
        if (isPublishedVersion) {
            dispatch(enqueueSnackbarAction({
                message: t('messages.publishedVersionReadOnly'),
                options: {
                    key: new Date().getTime() + Math.random(),
                    variant: 'warning'
                }
            }))
            return
        }
        
        // æ­£å¸¸ç‰ˆæœ¬ï¼šæ‰§è¡Œè¿æ¥é€»è¾‘
        if (!isValidConnection(params)) {
            return
        }
        setEdges((eds) => addEdge(params, eds))
    }, [isPublishedVersion, t, dispatch])
    
    const onDrop = useCallback((event) => {
        event.preventDefault()
        
        // å·²å‘å¸ƒç‰ˆæœ¬ï¼šé˜»æ­¢æ‹–æ‹½
        if (isPublishedVersion) {
            dispatch(enqueueSnackbarAction({
                message: t('messages.publishedVersionReadOnly'),
                options: { variant: 'warning' }
            }))
            return
        }
        
        // æ­£å¸¸ç‰ˆæœ¬ï¼šæ·»åŠ èŠ‚ç‚¹
        const nodeData = JSON.parse(event.dataTransfer.getData('application/reactflow'))
        // ... æ·»åŠ èŠ‚ç‚¹é€»è¾‘
    }, [isPublishedVersion, t, dispatch])
    
    // 3. æ¸²æŸ“
    return (
        <>
            {/* æ¡ä»¶æ¸²æŸ“ä¾§è¾¹æ  */}
            {!isPublishedVersion && <AddNodes />}
            
            <ReactFlow
                nodes={nodes}
                edges={edges}
                onConnect={onConnect}
                onDrop={onDrop}
                onDragOver={onDragOver}
                // åº•å±‚ç¦ç”¨
                nodesDraggable={!isPublishedVersion}
                nodesConnectable={!isPublishedVersion}
                deleteKeyCode={isPublishedVersion ? null : ['Delete', 'Backspace']}
                elementsSelectable={true}
            />
        </>
    )
}
```

---

## æœ€ä½³å®è·µ

### 1. çŠ¶æ€ç®¡ç† â­â­â­â­â­

```javascript
// âœ… DO: ä½¿ç”¨Reduxå•ä¸€æ•°æ®æº
const chatflow = useSelector((state) => state.canvas.chatflow)
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'

// âŒ DON'T: åœ¨ç»„ä»¶å†…éƒ¨ç»´æŠ¤çŠ¶æ€
const [isPublishedVersion, setIsPublishedVersion] = useState(false)
useEffect(() => {
    if (chatflow?.versionType === 'PUBLISH') {
        setIsPublishedVersion(true)
    }
}, [chatflow])
```

**åŸå› ï¼š**
- Reduxç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§
- useSelectorè‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½
- é¿å…é‡å¤åˆ¤æ–­é€»è¾‘

### 2. é˜²å¾¡æ€§ç¼–ç¨‹ â­â­â­â­â­

```javascript
// âœ… DO: ä½¿ç”¨å¯é€‰é“¾
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'

// âŒ DON'T: å‡è®¾å¯¹è±¡ä¸€å®šå­˜åœ¨
const isPublishedVersion = chatflow.versionType === 'PUBLISH'  // å¯èƒ½æŠ¥é”™
```

### 3. ç”¨æˆ·ä½“éªŒ â­â­â­â­â­

```javascript
// âœ… DO: æ“ä½œæ—¶æä¾›åé¦ˆ
if (isPublishedVersion) {
    enqueueSnackbar({
        message: t('messages.publishedVersionReadOnly'),
        options: { variant: 'warning' }
    })
    return
}

// âŒ DON'T: é™é»˜å¤±è´¥
if (isPublishedVersion) {
    return  // ç”¨æˆ·ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡ååº”
}
```

### 4. UIè®¾è®¡ â­â­â­â­â­

```javascript
// âœ… DO: æ¡ä»¶æ¸²æŸ“
{!isPublishedVersion && <DeleteButton />}

// âŒ DON'T: å¤æ‚çš„ç¦ç”¨é€»è¾‘
<DeleteButton 
    disabled={isPublishedVersion}
    style={{
        opacity: isPublishedVersion ? 0.5 : 1,
        cursor: isPublishedVersion ? 'not-allowed' : 'pointer',
        // ... æ›´å¤šæ ·å¼
    }}
/>
```

### 5. å¤šå±‚é˜²æŠ¤ â­â­â­â­â­

```javascript
// âœ… DO: å¤šå±‚ä¿æŠ¤
// ç¬¬1å±‚ï¼šUIæ‹¦æˆª
if (isPublishedVersion) {
    showWarning()
    return
}

// ç¬¬2å±‚ï¼šReactFlowé…ç½®
<ReactFlow 
    nodesDraggable={!isPublishedVersion}
    nodesConnectable={!isPublishedVersion}
/>

// âŒ DON'T: åªä¾èµ–ä¸€å±‚
<ReactFlow />  // æ²¡æœ‰é…ç½®çº§åˆ«çš„ä¿æŠ¤
```

### 6. å›½é™…åŒ–æ”¯æŒ â­â­â­â­

```javascript
// âœ… DO: ä½¿ç”¨å›½é™…åŒ–
const { t } = useI18n()
message: t('messages.publishedVersionReadOnly')

// âŒ DON'T: ç¡¬ç¼–ç æ–‡æ¡ˆ
message: 'å·²å‘å¸ƒç‰ˆæœ¬ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•ç¼–è¾‘'
```

### 7. ä¸»é¢˜é€‚é… â­â­â­â­

```javascript
// âœ… DO: ä½¿ç”¨ä¸»é¢˜è‰²
<Lock color={theme.palette.primary.main} />

// âŒ DON'T: ç¡¬ç¼–ç é¢œè‰²
<Lock color="#3C89E8" />
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸åœ¨åç«¯æ‹¦æˆªï¼Ÿ

**A:** å‰åç«¯éƒ½éœ€è¦ï¼

```
å‰ç«¯æ‹¦æˆªï¼š
âœ… å“åº”å¿«
âœ… å³æ—¶åé¦ˆ
âœ… å‡å°‘ç½‘ç»œè¯·æ±‚
âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

åç«¯æ‹¦æˆªï¼š
âœ… å®‰å…¨å…œåº•
âœ… é˜²æ­¢APIç»•è¿‡
âœ… æ•°æ®å®Œæ•´æ€§ä¿æŠ¤
```

**å»ºè®®ï¼š** å‰ç«¯æä¾›ä½“éªŒï¼Œåç«¯ç¡®ä¿å®‰å…¨

### Q2: å¤åˆ¶åŠŸèƒ½è¦ä¸è¦ä¿ç•™ï¼Ÿ

**A:** æ ¹æ®ä¸šåŠ¡åœºæ™¯å†³å®š

```
ä¿ç•™å¤åˆ¶ï¼š
âœ… ç”¨æˆ·å¯ä»¥å¤åˆ¶å·²å‘å¸ƒç‰ˆæœ¬åˆ›å»ºè‰ç¨¿
âœ… æœ‰åˆ©äºè¿­ä»£å¼€å‘
âŒ èœå•é¡¹ä¸ä¸€è‡´

éšè—å¤åˆ¶ï¼š
âœ… UIæ¸…æ™°ä¸€è‡´
âœ… å®Œå…¨åªè¯»æ¦‚å¿µ
âŒ ç”¨æˆ·éœ€è¦å…ˆåˆ‡æ¢åˆ°è‰ç¨¿ç‰ˆæœ¬
```

**æœ¬é¡¹ç›®é€‰æ‹©ï¼š** éšè—ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰

### Q3: å¦‚ä½•å¤„ç†ç”¨æˆ·ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½ç¼–è¾‘ï¼Ÿ

**A:** å¤šé‡æç¤º

```
1. è§†è§‰æç¤ºï¼šé¡¶éƒ¨é”å›¾æ ‡
2. æ“ä½œåé¦ˆï¼šå°è¯•ç¼–è¾‘æ—¶æ˜¾ç¤ºè­¦å‘Š
3. å¸®åŠ©æ–‡æ¡£ï¼šè¯´æ˜å·²å‘å¸ƒç‰ˆæœ¬çš„ç‰¹æ€§
```

### Q4: æ€§èƒ½ä¼šæœ‰å½±å“å—ï¼Ÿ

**A:** å‡ ä¹æ— å½±å“

```javascript
// useSelectorä¼šè‡ªåŠ¨ä¼˜åŒ–
const chatflow = useSelector((state) => state.canvas.chatflow)

// åªåœ¨chatflowå˜åŒ–æ—¶é‡æ–°è®¡ç®—
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'
```

### Q5: å¦‚ä½•æµ‹è¯•åªè¯»æ¨¡å¼ï¼Ÿ

**æµ‹è¯•æ¸…å•ï¼š**

```markdown
[ ] æ‹–æ‹½èŠ‚ç‚¹ - åº”è¯¥æ— æ³•ç§»åŠ¨
[ ] è¿æ¥èŠ‚ç‚¹ - åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
[ ] åŒå‡»èŠ‚ç‚¹ - åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
[ ] é”®ç›˜åˆ é™¤ - åº”è¯¥æ— æ•ˆ
[ ] å³é”®èœå• - åªæ˜¾ç¤º"ä¿¡æ¯"
[ ] ä¾§è¾¹æ  - åº”è¯¥éšè—
[ ] ä¿å­˜æŒ‰é’® - åº”è¯¥éšè—
[ ] é”å›¾æ ‡ - åº”è¯¥æ˜¾ç¤º
[ ] åˆ‡æ¢ç‰ˆæœ¬ - åŠŸèƒ½åº”è¯¥æ¢å¤
```

---

## æ€ç»´å¯¼å›¾

```
åªè¯»æ¨¡å¼å®ç°
â”œâ”€ 1. éœ€æ±‚åˆ†æ
â”‚  â”œâ”€ ä¸šåŠ¡åœºæ™¯ï¼šä¿æŠ¤ç”Ÿäº§ç¯å¢ƒ
â”‚  â”œâ”€ ç”¨æˆ·éœ€æ±‚ï¼šæ¸…æ™°çš„åªè¯»æç¤º
â”‚  â””â”€ æŠ€æœ¯è¦æ±‚ï¼šå…¨é¢çš„ç¼–è¾‘ç¦ç”¨
â”‚
â”œâ”€ 2. æ¶æ„è®¾è®¡
â”‚  â”œâ”€ çŠ¶æ€ç®¡ç†ï¼šReduxå•ä¸€æ•°æ®æº
â”‚  â”œâ”€ åˆ¤æ–­é€»è¾‘ï¼šversionType === 'PUBLISH'
â”‚  â””â”€ é˜²æŠ¤ç­–ç•¥ï¼šä¸‰å±‚ä¿æŠ¤
â”‚
â”œâ”€ 3. å®ç°æ–¹æ¡ˆ
â”‚  â”œâ”€ ç”»å¸ƒå±‚ï¼šæ“ä½œæ‹¦æˆª + åº•å±‚ç¦ç”¨
â”‚  â”œâ”€ èŠ‚ç‚¹å±‚ï¼šæ¡ä»¶æ¸²æŸ“èœå•
â”‚  â”œâ”€ å·¥å…·æ ï¼šéšè—ç¼–è¾‘æŒ‰é’® + é”å›¾æ ‡
â”‚  â””â”€ å¯¹è¯æ¡†ï¼šç¦ç”¨æ‰€æœ‰è¾“å…¥
â”‚
â”œâ”€ 4. ç”¨æˆ·ä½“éªŒ
â”‚  â”œâ”€ è§†è§‰æç¤ºï¼šé”å›¾æ ‡
â”‚  â”œâ”€ æ“ä½œåé¦ˆï¼šè­¦å‘Šæç¤º
â”‚  â””â”€ UIç®€æ´ï¼šéšè—ä¸å¯ç”¨åŠŸèƒ½
â”‚
â””â”€ 5. è´¨é‡ä¿è¯
   â”œâ”€ é˜²å¾¡æ€§ç¼–ç¨‹ï¼šå¯é€‰é“¾
   â”œâ”€ å¤šå±‚é˜²æŠ¤ï¼šä¸ä¾èµ–å•ä¸€é˜²çº¿
   â”œâ”€ å›½é™…åŒ–ï¼šæ”¯æŒå¤šè¯­è¨€
   â””â”€ ä¸»é¢˜é€‚é…ï¼šè‡ªåŠ¨é€‚é…æ˜æš—æ¨¡å¼
```

---

## å­¦ä¹ è¦ç‚¹æ€»ç»“

### ğŸ¯ æ ¸å¿ƒç†å¿µ

1. **å•ä¸€æ•°æ®æº**
   - çŠ¶æ€é›†ä¸­ç®¡ç†
   - é¿å…ä¸ä¸€è‡´

2. **é˜²å¾¡æ€§ç¼–ç¨‹**
   - å¯é€‰é“¾ä¿æŠ¤
   - è¾¹ç•Œæƒ…å†µå¤„ç†

3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**
   - æ¸…æ™°çš„è§†è§‰æç¤º
   - å‹å¥½çš„é”™è¯¯åé¦ˆ
   - ç®€æ´çš„UIè®¾è®¡

4. **å¤šå±‚é˜²æŠ¤**
   - UIå±‚æ‹¦æˆª
   - åº•å±‚é…ç½®
   - åç«¯éªŒè¯

5. **æç®€ä¸»ä¹‰**
   - Less is More
   - åªä¿ç•™å¿…è¦å…ƒç´ 
   - ä¸æ–­ä¼˜åŒ–ç®€åŒ–

### ğŸ“š å¯å¤ç”¨çš„æ¨¡å¼

```javascript
// æ¨¡å¼1: çŠ¶æ€é©±åŠ¨UI
const isXXX = useSelector(...)
{!isXXX && <Component />}

// æ¨¡å¼2: æ“ä½œæ‹¦æˆª
const handleAction = () => {
    if (shouldBlock) {
        showWarning()
        return
    }
    // æ­£å¸¸é€»è¾‘
}

// æ¨¡å¼3: å¤šå±‚é˜²æŠ¤
// UIå±‚ + é…ç½®å±‚ + åç«¯å±‚

// æ¨¡å¼4: æ¸è¿›å¼ä¼˜åŒ–
// V1: å®ç°åŠŸèƒ½
// V2: ä¼˜åŒ–ä½“éªŒ
// V3: æç®€è®¾è®¡
```

---

## ç»“è¯­

è¿™ä¸ªåŠŸèƒ½çš„å®ç°å±•ç¤ºäº†ä»**éœ€æ±‚åˆ†æ** â†’ **æ¶æ„è®¾è®¡** â†’ **ä»£ç å®ç°** â†’ **æŒç»­ä¼˜åŒ–**çš„å®Œæ•´è¿‡ç¨‹ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- âœ… æ¸…æ™°çš„æ€è€ƒæ¡†æ¶
- âœ… å¯å¤ç”¨çš„ä»£ç æ¨¡å¼
- âœ… ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ
- âœ… é«˜è´¨é‡çš„ä»£ç å®ç°

**é€‚ç”¨åœºæ™¯ï¼š**
- åªè¯»æ¨¡å¼å®ç°
- æƒé™æ§åˆ¶
- çŠ¶æ€é©±åŠ¨UI
- å¤šå±‚é˜²æŠ¤è®¾è®¡

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ ç†è§£**å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€ä¸ªé«˜è´¨é‡çš„åŠŸèƒ½**ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-10-29  
**ä½œè€…ï¼š** Agent Factory Team

# å·²å‘å¸ƒAgentåªè¯»ä¿æŠ¤åŠŸèƒ½å®ç°æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°
å½“Agentå·²ç»å‘å¸ƒï¼ˆ`versionType === 'PUBLISH'`ï¼‰åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å¯ç”¨åªè¯»ä¿æŠ¤æ¨¡å¼ï¼Œé˜²æ­¢å¯¹å·²å‘å¸ƒç‰ˆæœ¬è¿›è¡Œä»»ä½•ç¼–è¾‘æ“ä½œã€‚

## å®ç°çš„åŠŸèƒ½ç‚¹

### 1. ç”»å¸ƒç¼–è¾‘æ“ä½œç¦ç”¨
**æ–‡ä»¶**: `packages/ui/src/views/agentflowsv2/Canvas.jsx`

- âœ… **ç¦æ­¢è¿æ¥èŠ‚ç‚¹**: å·²å‘å¸ƒç‰ˆæœ¬ä¸èƒ½åˆ›å»ºæ–°çš„èŠ‚ç‚¹è¿æ¥
- âœ… **ç¦æ­¢æ‹–æ‹½æ·»åŠ èŠ‚ç‚¹**: ä¸èƒ½ä»ä¾§è¾¹æ æ‹–æ‹½æ·»åŠ æ–°èŠ‚ç‚¹åˆ°ç”»å¸ƒ
- âœ… **ç¦æ­¢åŒå‡»ç¼–è¾‘èŠ‚ç‚¹**: åŒå‡»èŠ‚ç‚¹æ—¶æ˜¾ç¤ºè­¦å‘Šæç¤ºï¼Œä¸æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†
- âœ… **ç¦æ­¢æ‹–æ‹½ç§»åŠ¨èŠ‚ç‚¹**: è®¾ç½® `nodesDraggable={!isPublishedVersion}`
- âœ… **ç¦æ­¢åˆ é™¤èŠ‚ç‚¹ï¼ˆé”®ç›˜ï¼‰**: è®¾ç½® `deleteKeyCode` åœ¨å·²å‘å¸ƒç‰ˆæœ¬æ—¶ä¸º `null`
- âœ… **ç¦æ­¢ä¿®æ”¹è¿æ¥**: è®¾ç½® `nodesConnectable={!isPublishedVersion}`
- âœ… **ç¦æ­¢æ ‡è®°ä¸ºè„çŠ¶æ€**: å·²å‘å¸ƒç‰ˆæœ¬çš„ä¿®æ”¹ä¸ä¼šè§¦å‘"æœªä¿å­˜æ›´æ”¹"æç¤º

### 1.5 èŠ‚ç‚¹å³é”®èœå•ä¿æŠ¤
**æ–‡ä»¶**: 
- `packages/ui/src/views/agentflowsv2/AgentFlowNode.jsx`
- `packages/ui/src/views/agentflowsv2/IterationNode.jsx`
- `packages/ui/src/views/agentflowsv2/StickyNote.jsx`

- âœ… **éšè—å¤åˆ¶å’Œåˆ é™¤æŒ‰é’®**: å·²å‘å¸ƒç‰ˆæœ¬æ—¶ç›´æ¥ä¸æ˜¾ç¤ºè¿™ä¸¤ä¸ªæŒ‰é’®
- âœ… **åªä¿ç•™ä¿¡æ¯æŒ‰é’®**: å…è®¸ç”¨æˆ·æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
- âœ… **ç®€æ´æ¸…æ™°**: ä¸éœ€è¦ä»»ä½•æç¤ºï¼Œç”¨æˆ·ä¸€çœ¼å°±çŸ¥é“æ˜¯åªè¯»æ¨¡å¼

### 2. èŠ‚ç‚¹ç¼–è¾‘å¯¹è¯æ¡†åªè¯»æ¨¡å¼
**æ–‡ä»¶**: `packages/ui/src/views/agentflowsv2/EditNodeDialog.jsx`

- âœ… **ç¦ç”¨èŠ‚ç‚¹åç§°ç¼–è¾‘**: éšè—èŠ‚ç‚¹åç§°ç¼–è¾‘æŒ‰é’®
- âœ… **ç¦ç”¨å‚æ•°è¾“å…¥**: æ‰€æœ‰è¾“å…¥å­—æ®µè®¾ç½®ä¸º `disabled` çŠ¶æ€
- âœ… **æ¥æ”¶åªè¯»å±æ€§**: é€šè¿‡ `dialogProps.isReadOnly` æ¥æ”¶åªè¯»æ ‡å¿—

### 3. ä¾§è¾¹æ èŠ‚ç‚¹ç®¡ç†
**æ–‡ä»¶**: `packages/ui/src/views/agentflowsv2/Canvas.jsx`

- âœ… **éšè—æ·»åŠ èŠ‚ç‚¹ä¾§è¾¹æ **: å·²å‘å¸ƒç‰ˆæœ¬å®Œå…¨éšè—ä¾§è¾¹æ 
- âœ… **è‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå®½åº¦**: ç”»å¸ƒè‡ªåŠ¨å æ»¡å…¨å±ï¼ˆä¸é¢„ç•™ä¾§è¾¹æ ç©ºé—´ï¼‰

### 4. é¡¶éƒ¨å·¥å…·æ è°ƒæ•´
**æ–‡ä»¶**: `packages/ui/src/views/canvas/CanvasHeader.jsx`

- âœ… **éšè—ä¿å­˜æŒ‰é’®**: å·²å‘å¸ƒç‰ˆæœ¬ä¸æ˜¾ç¤ºä¿å­˜æŒ‰é’®
- âœ… **éšè—åˆ é™¤æŒ‰é’®**: å·²å‘å¸ƒç‰ˆæœ¬ä¸æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
- âœ… **éšè—å­˜æ¡£æŒ‰é’®**: å·²å‘å¸ƒç‰ˆæœ¬ä¸æ˜¾ç¤ºå­˜æ¡£æŒ‰é’®
- âœ… **éšè—å‘å¸ƒæŒ‰é’®**: å·²å‘å¸ƒç‰ˆæœ¬ä¸æ˜¾ç¤ºå‘å¸ƒæŒ‰é’®
- âœ… **æ˜¾ç¤ºåªè¯»æ ‡ç­¾**: åœ¨Agentåç§°æ—è¾¹æ˜¾ç¤ºè“è‰²çš„"åªè¯»"æ ‡ç­¾ï¼Œå¸¦é”å›¾æ ‡

### 5. å›½é™…åŒ–æ”¯æŒ
**æ–‡ä»¶**: 
- `packages/ui/src/i18n/locales/zh/agentcanvas.json`
- `packages/ui/src/i18n/locales/en/agentcanvas.json`

- âœ… **ä¸­æ–‡æ”¯æŒ**: æ·»åŠ äº†"åªè¯»"æ ‡ç­¾å’Œ"å·²å‘å¸ƒç‰ˆæœ¬ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•ç¼–è¾‘"æç¤ºæ¶ˆæ¯
- âœ… **è‹±æ–‡æ”¯æŒ**: æ·»åŠ äº†"Read Only"æ ‡ç­¾å’Œ"Published version is read-only and cannot be edited"æç¤ºæ¶ˆæ¯

## ç”¨æˆ·ä½“éªŒ

### å·²å‘å¸ƒç‰ˆæœ¬çš„ç‰¹å¾
1. **è§†è§‰æç¤º**: åœ¨Agentåç§°æ—è¾¹æ˜¾ç¤ºé†’ç›®çš„è“è‰²"åªè¯»"æ ‡ç­¾
2. **æ“ä½œåé¦ˆ**: ä»»ä½•ç¼–è¾‘æ“ä½œï¼ˆè¿æ¥ã€æ‹–æ‹½ã€åŒå‡»ç­‰ï¼‰éƒ½ä¼šæ˜¾ç¤ºè­¦å‘Šæç¤º
3. **ç®€æ´ç•Œé¢**: è‡ªåŠ¨éšè—æ‰€æœ‰ç¼–è¾‘ç›¸å…³çš„æŒ‰é’®å’Œä¾§è¾¹æ 
4. **æ— è„çŠ¶æ€**: ä¸ä¼šå‡ºç°æœªä¿å­˜æ›´æ”¹çš„æç¤º

### å¦‚ä½•åˆ‡æ¢å›å¯ç¼–è¾‘çŠ¶æ€
è¦ç¼–è¾‘å·²å‘å¸ƒçš„Agentï¼Œéœ€è¦ï¼š
1. åœ¨ç‰ˆæœ¬å†å²ä¸­åˆ‡æ¢å›è‰ç¨¿ç‰ˆæœ¬ï¼ˆ`versionType === 'DRAFT'`ï¼‰
2. æˆ–è€…åˆ›å»ºæ–°çš„è‰ç¨¿ç‰ˆæœ¬è¿›è¡Œç¼–è¾‘

## æŠ€æœ¯å®ç°ç»†èŠ‚

### åˆ¤æ–­é€»è¾‘
```javascript
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'
```

### å…³é”®ä»£ç ä½ç½®

#### Canvas.jsx - ç¬¬112-120è¡Œ
```javascript
// åˆ¤æ–­æ˜¯å¦ä¸ºå·²å‘å¸ƒç‰ˆæœ¬
const isPublishedVersion = chatflow?.versionType === 'PUBLISH'

// å·²å‘å¸ƒç‰ˆæœ¬æ—¶æ¸…é™¤dirtyçŠ¶æ€
useEffect(() => {
    if (isPublishedVersion && canvasDataStore.isDirty) {
        dispatch({ type: REMOVE_DIRTY })
    }
}, [isPublishedVersion, canvasDataStore.isDirty, dispatch])
```

#### Canvas.jsx - ç¬¬1251-1258è¡Œ
```javascript
deleteKeyCode={canvas.canvasDialogShow || isPublishedVersion ? null : ['Delete', 'Backspace']}
minZoom={0.5}
snapGrid={[25, 25]}
snapToGrid={isSnappingEnabled}
connectionLineComponent={ConnectionLine}
nodesDraggable={!isPublishedVersion}
nodesConnectable={!isPublishedVersion}
elementsSelectable={true}
```

#### CanvasHeader.jsx - ç¬¬649-673è¡Œ
```javascript
{isPublishedVersion && (
    <Box
        sx={{
            display: 'flex',
            alignItems: 'center',
            gap: '4px',
            px: 1,
            py: 0.5,
            borderRadius: '4px',
            backgroundColor: customization.isDarkMode ? 'rgba(59, 130, 246, 0.2)' : 'rgba(59, 130, 246, 0.1)',
            border: `1px solid ${customization.isDarkMode ? 'rgba(59, 130, 246, 0.4)' : 'rgba(59, 130, 246, 0.3)'}`
        }}
    >
        <IconLock size={14} color={customization.isDarkMode ? '#60A5FA' : '#3B82F6'} />
        <Typography
            sx={{
                fontSize: '12px',
                fontWeight: 500,
                color: customization.isDarkMode ? '#60A5FA' : '#3B82F6'
            }}
        >
            {t('canvasHeader.labels.readOnly')}
        </Typography>
    </Box>
)}
```

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. âœ… å‘å¸ƒä¸€ä¸ªAgentï¼Œç¡®è®¤çŠ¶æ€å˜ä¸º `PUBLISH`
2. âœ… å°è¯•æ‹–æ‹½èŠ‚ç‚¹ - åº”è¯¥æ— æ³•ç§»åŠ¨
3. âœ… å°è¯•æ‹–æ‹½æ–°èŠ‚ç‚¹åˆ°ç”»å¸ƒ - åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
4. âœ… å°è¯•åŒå‡»èŠ‚ç‚¹ - åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
5. âœ… å°è¯•è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ - åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
6. âœ… å°è¯•åˆ é™¤èŠ‚ç‚¹ï¼ˆDeleteé”®ï¼‰- åº”è¯¥æ— æ•ˆ
7. âœ… æ£€æŸ¥é¡¶éƒ¨å·¥å…·æ  - ä¿å­˜/åˆ é™¤/å­˜æ¡£/å‘å¸ƒæŒ‰é’®åº”è¯¥éšè—
8. âœ… æ£€æŸ¥ä¾§è¾¹æ  - æ·»åŠ èŠ‚ç‚¹ä¾§è¾¹æ åº”è¯¥éšè—
9. âœ… æ£€æŸ¥åªè¯»æ ‡ç­¾ - åº”è¯¥æ˜¾ç¤ºåœ¨Agentåç§°æ—è¾¹

### ç‰ˆæœ¬åˆ‡æ¢æµ‹è¯•
1. ä»å·²å‘å¸ƒç‰ˆæœ¬åˆ‡æ¢åˆ°è‰ç¨¿ç‰ˆæœ¬ - åº”è¯¥æ¢å¤æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½
2. ä»è‰ç¨¿ç‰ˆæœ¬åˆ‡æ¢åˆ°å·²å‘å¸ƒç‰ˆæœ¬ - åº”è¯¥è¿›å…¥åªè¯»æ¨¡å¼

## ç›¸å…³æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. `/packages/ui/src/views/agentflowsv2/Canvas.jsx` - ä¸»ç”»å¸ƒç»„ä»¶
2. `/packages/ui/src/views/agentflowsv2/EditNodeDialog.jsx` - èŠ‚ç‚¹ç¼–è¾‘å¯¹è¯æ¡†
3. `/packages/ui/src/views/canvas/CanvasHeader.jsx` - é¡¶éƒ¨å·¥å…·æ 
4. `/packages/ui/src/views/agentflowsv2/AgentFlowNode.jsx` - èŠ‚ç‚¹å³é”®èœå•
5. `/packages/ui/src/views/agentflowsv2/IterationNode.jsx` - è¿­ä»£èŠ‚ç‚¹å³é”®èœå•
6. `/packages/ui/src/views/agentflowsv2/StickyNote.jsx` - ä¾¿ç­¾èŠ‚ç‚¹å³é”®èœå•
7. `/packages/ui/src/store/context/ReactFlowContext.jsx` - å¢å¼ºcontextä¼ é€’çŠ¶æ€
8. `/packages/ui/src/i18n/locales/zh/agentcanvas.json` - ä¸­æ–‡å›½é™…åŒ–
9. `/packages/ui/src/i18n/locales/en/agentcanvas.json` - è‹±æ–‡å›½é™…åŒ–

### æ¶‰åŠçš„æ•°æ®åº“å­—æ®µ
- `ChatFlow.versionType` - ç‰ˆæœ¬ç±»å‹æšä¸¾ ('DRAFT' | 'ARCHIVE' | 'PUBLISH')

## å®ŒæˆçŠ¶æ€
âœ… æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶é€šè¿‡lintæ£€æŸ¥ï¼Œæ— ä»»ä½•é”™è¯¯ã€‚

