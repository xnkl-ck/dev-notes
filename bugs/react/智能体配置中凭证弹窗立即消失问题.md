# Bug ä¿®å¤æ–‡æ¡£ï¼šæ™ºèƒ½ä½“é…ç½®ä¸­å‡­è¯å¼¹çª—ç«‹å³æ¶ˆå¤±é—®é¢˜

## ğŸ“‹ é—®é¢˜æè¿°

### é—®é¢˜ç°è±¡
åœ¨æ™ºèƒ½ä½“çš„è‰ç¨¿åˆ—è¡¨ä¸­ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œæ—¶ä¼šå‡ºç°å¼¹çª—ç«‹å³æ¶ˆå¤±çš„é—®é¢˜ï¼š
1. ç‚¹å‡»æ™ºèƒ½ä½“è¯¦æƒ…
2. ç‚¹å‡»å³ä¸Šè§’"é…ç½®"æŒ‰é’®
3. åˆ‡æ¢åˆ°"åˆ†æèŠå¤©æµ"æ ‡ç­¾
4. å±•å¼€ä»»æ„åˆ†ææä¾›å•†ï¼ˆå¦‚ LangSmithã€LangFuse ç­‰ï¼‰
5. ç‚¹å‡»"è¿æ¥å‡­è¯"çš„"åˆ›å»º"æŒ‰é’®
6. **å¼¹çª—ä¼šçŸ­æš‚å‡ºç°ï¼Œç„¶åç«‹å³æ¶ˆå¤±** âŒ

### å¯¹æ¯”ç°è±¡
- âŒ **æ™ºèƒ½ä½“é…ç½®ä¸­**ï¼šå¼¹çª—ç«‹å³æ¶ˆå¤±ï¼ˆæœ‰é—®é¢˜ï¼‰
- âœ… **å·¥ä½œæµé…ç½®ä¸­**ï¼šå¼¹çª—æ­£å¸¸æ˜¾ç¤ºï¼ˆæ— é—®é¢˜ï¼‰

### ç”¨æˆ·ä½“éªŒå½±å“
- æ— æ³•åˆ›å»ºæ–°å‡­è¯
- ç”¨æˆ·æ“ä½œè¢«ä¸­æ–­
- é€ æˆå›°æƒ‘å’Œä¸è‰¯ä½“éªŒ

---

## ğŸ” é—®é¢˜åˆ†æ

### æ¶‰åŠçš„æ–‡ä»¶
```
packages/ui/src/ui-component/extended/AnalyseFlow.jsx
packages/ui/src/views/canvas/CredentialInputHandler.jsx
packages/ui/src/views/credentials/CredentialListDialog.jsx
packages/ui/src/views/credentials/AddEditCredentialDialog.jsx
```

### ç»„ä»¶å±‚çº§å…³ç³»
```
ChatflowConfigurationDialog (é…ç½®å¯¹è¯æ¡†)
  â””â”€> AnalyseFlow (åˆ†æèŠå¤©æµç»„ä»¶)
      â””â”€> Accordion (æŠ˜å é¢æ¿)
          â””â”€> CredentialInputHandler (å‡­è¯è¾“å…¥å¤„ç†å™¨)
              â”œâ”€> CredentialListDialog (å‡­è¯åˆ—è¡¨å¯¹è¯æ¡†)
              â””â”€> AddEditCredentialDialog (åˆ›å»º/ç¼–è¾‘å‡­è¯å¯¹è¯æ¡†)
```

### é—®é¢˜çš„è§¦å‘é“¾è·¯

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Accordion as Accordionç»„ä»¶
    participant AnalyseFlow as AnalyseFlowç»„ä»¶
    participant Redux as Redux Store
    participant Dialog as å‡­è¯å¯¹è¯æ¡†
    
    User->>Accordion: 1. å±•å¼€ LangSmith
    Accordion->>AnalyseFlow: providerExpanded = {langSmith: true}
    AnalyseFlow->>Dialog: 2. æ¸²æŸ“ CredentialInputHandler
    
    User->>Dialog: 3. ç‚¹å‡»"åˆ›å»ºå‡­è¯"
    Dialog->>Redux: 4. dispatch(SHOW_CANVAS_DIALOG)
    Redux->>AnalyseFlow: 5. Reduxæ›´æ–°ï¼ŒdialogPropså¼•ç”¨æ”¹å˜
    
    Note over AnalyseFlow: 6. useEffect æ£€æµ‹åˆ° dialogProps æ”¹å˜
    AnalyseFlow->>AnalyseFlow: 7. æ‰§è¡Œ cleanup: setProviderExpanded({})
    AnalyseFlow->>Accordion: 8. Accordion æŠ˜å 
    Accordion->>Dialog: 9. å¸è½½ CredentialInputHandler
    Dialog->>User: 10. å¼¹çª—æ¶ˆå¤± âŒ
```

### æ ¸å¿ƒåŸå› 

#### åŸå›  1ï¼šè¿‡åº¦çš„ useEffect cleanup
**é—®é¢˜ä»£ç ï¼š**
```javascript
useEffect(() => {
    if (dialogProps.chatflow && dialogProps.chatflow.analytic) {
        setAnalytic(JSON.parse(dialogProps.chatflow.analytic))
    }
    
    return () => {
        setAnalytic({})
        setProviderExpanded({})  // âš ï¸ é—®é¢˜ï¼šæ¯æ¬¡ dialogProps æ”¹å˜éƒ½é‡ç½®
    }
}, [dialogProps])  // dialogProps å¯¹è±¡å¼•ç”¨é¢‘ç¹æ”¹å˜
```

**é—®é¢˜åˆ†æï¼š**
- `dialogProps` æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œå³ä½¿å†…å®¹ç›¸åŒï¼Œå¼•ç”¨æ”¹å˜å°±ä¼šè§¦å‘ useEffect
- å½“ç”¨æˆ·æ‰“å¼€å‡­è¯å¯¹è¯æ¡†æ—¶ï¼ŒRedux çŠ¶æ€æ›´æ–°å¯¼è‡´ `dialogProps` å¼•ç”¨æ”¹å˜
- useEffect æ‰§è¡Œ cleanup å‡½æ•°ï¼Œè°ƒç”¨ `setProviderExpanded({})`
- æ‰€æœ‰ Accordion è¢«å¼ºåˆ¶æŠ˜å 
- å­ç»„ä»¶ `CredentialInputHandler` è¢«å¸è½½
- å¯¹è¯æ¡†çŠ¶æ€ä¸¢å¤±ï¼Œå¼¹çª—æ¶ˆå¤±

#### åŸå›  2ï¼šæ¡ä»¶æ¸²æŸ“å¯¼è‡´ç»„ä»¶å¸è½½
**é—®é¢˜ä»£ç ï¼š**
```javascript
<AccordionDetails>
    {provider.inputs.map((inputParam, index) => (
        <Box key={index}>
            {providerExpanded[provider.name] && inputParam.type === 'credential' && (
                <CredentialInputHandler />  // âš ï¸ ä¾èµ– providerExpanded
            )}
        </Box>
    ))}
</AccordionDetails>
```

**é—®é¢˜åˆ†æï¼š**
- å½“ `providerExpanded[provider.name]` å˜ä¸º `undefined` æ—¶
- æ¡ä»¶æ¸²æŸ“å¤±è´¥ï¼š`undefined && <CredentialInputHandler />` = `false`
- `CredentialInputHandler` ç»„ä»¶è¢«ä» DOM ä¸­ç§»é™¤ï¼ˆå¸è½½ï¼‰
- ç»„ä»¶å†…éƒ¨ç®¡ç†çš„æ‰€æœ‰çŠ¶æ€ï¼ˆåŒ…æ‹¬å¯¹è¯æ¡†çŠ¶æ€ï¼‰å…¨éƒ¨ä¸¢å¤±

### React åŸºç¡€çŸ¥è¯†è¡¥å……

#### 1. useEffect çš„æ‰§è¡Œæ—¶æœº
```javascript
useEffect(() => {
    // â‘  ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ
    // â‘¡ ä¾èµ–é¡¹æ”¹å˜æ—¶æ‰§è¡Œ
    console.log('æ‰§è¡Œ effect')
    
    return () => {
        // â‘¢ ä¸‹æ¬¡ effect æ‰§è¡Œå‰å…ˆæ‰§è¡Œè¿™é‡Œï¼ˆcleanupï¼‰
        // â‘£ ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œè¿™é‡Œ
        console.log('æ¸…ç† effect')
    }
}, [ä¾èµ–é¡¹])
```

**æ‰§è¡Œé¡ºåºç¤ºä¾‹ï¼š**
```
åˆå§‹æ¸²æŸ“ï¼š
  â†’ æ‰§è¡Œ effect

ä¾èµ–é¡¹æ”¹å˜ï¼š
  â†’ æ‰§è¡Œ cleanupï¼ˆæ¸…ç†æ—§çš„ effectï¼‰
  â†’ æ‰§è¡Œ effectï¼ˆæ‰§è¡Œæ–°çš„ effectï¼‰

ç»„ä»¶å¸è½½ï¼š
  â†’ æ‰§è¡Œ cleanup
```

#### 2. å¯¹è±¡å¼•ç”¨ä¸ç›¸ç­‰æ€§
```javascript
const obj1 = { name: 'test' }
const obj2 = { name: 'test' }

console.log(obj1 === obj2)  // falseï¼ˆå¼•ç”¨ä¸åŒï¼‰

// åœ¨ React ä¸­
useEffect(() => {
    // å³ä½¿å¯¹è±¡å†…å®¹ç›¸åŒï¼Œåªè¦å¼•ç”¨ä¸åŒå°±ä¼šè§¦å‘
}, [dialogProps])  // dialogProps æ˜¯å¯¹è±¡
```

#### 3. æ¡ä»¶æ¸²æŸ“ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
```javascript
// åœºæ™¯ 1ï¼šç»„ä»¶ä¿æŒæŒ‚è½½
<div style={{ display: show ? 'block' : 'none' }}>
    <MyComponent />  // ç»„ä»¶å§‹ç»ˆå­˜åœ¨ï¼ŒçŠ¶æ€ä¿ç•™
</div>

// åœºæ™¯ 2ï¼šç»„ä»¶è¢«å¸è½½
{show && <MyComponent />}  // show=false æ—¶ç»„ä»¶è¢«é”€æ¯ï¼ŒçŠ¶æ€ä¸¢å¤±
```

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1ï¼šç§»é™¤è¿‡åº¦çš„ cleanup å‡½æ•°

**ä¿®æ”¹æ–‡ä»¶ï¼š** `packages/ui/src/ui-component/extended/AnalyseFlow.jsx`

**ä¿®æ”¹ä½ç½®ï¼š** ç¬¬ 292-304 è¡Œ

**ä¿®æ”¹å‰ï¼š**
```javascript
useEffect(() => {
    if (dialogProps.chatflow && dialogProps.chatflow.analytic) {
        try {
            setAnalytic(JSON.parse(dialogProps.chatflow.analytic))
        } catch (e) {
            setAnalytic({})
            console.error(e)
        }
    }

    return () => {
        setAnalytic({})
        setProviderExpanded({})  // âŒ é—®é¢˜ä»£ç 
    }
}, [dialogProps])
```

**ä¿®æ”¹åï¼š**
```javascript
useEffect(() => {
    if (dialogProps.chatflow && dialogProps.chatflow.analytic) {
        try {
            setAnalytic(JSON.parse(dialogProps.chatflow.analytic))
        } catch (e) {
            setAnalytic({})
            console.error(e)
        }
    }

    // âœ… ç§»é™¤äº† cleanup å‡½æ•°
    // è®© providerExpanded çŠ¶æ€ä¿æŒç¨³å®šï¼Œä¸ä¼šå› ä¸º dialogProps æ”¹å˜è€Œé‡ç½®
}, [dialogProps])
```

**ä¿®å¤åŸç†ï¼š**
- ç§»é™¤äº† cleanup å‡½æ•°ä¸­çš„çŠ¶æ€é‡ç½®é€»è¾‘
- `providerExpanded` çŠ¶æ€åªåœ¨ç”¨æˆ·ç‚¹å‡» Accordion æ—¶æ”¹å˜
- ä¸ä¼šå› ä¸º Redux æ›´æ–°æˆ– props æ”¹å˜è€Œè¢«æ„å¤–é‡ç½®

### ä¿®å¤ 2ï¼šä¼˜åŒ–æ¡ä»¶æ¸²æŸ“å’Œæ·»åŠ ç¨³å®š key

**ä¿®æ”¹æ–‡ä»¶ï¼š** `packages/ui/src/ui-component/extended/AnalyseFlow.jsx`

**ä¿®æ”¹ä½ç½®ï¼š** ç¬¬ 375-416 è¡Œ

**ä¿®æ”¹å‰ï¼š**
```javascript
<AccordionDetails>
    {provider.inputs.map((inputParam, index) => (
        <Box key={index} sx={{ p: 2 }}>
            {/* ... */}
            {providerExpanded[provider.name] && inputParam.type === 'credential' && (
                <CredentialInputHandler
                    data={analytic[provider.name] ? { credential: analytic[provider.name].credentialId } : {}}
                    inputParam={inputParam}
                    onSelect={(newValue) => setValue(newValue, provider.name, 'credentialId')}
                />
            )}
        </Box>
    ))}
</AccordionDetails>
```

**ä¿®æ”¹åï¼š**
```javascript
<AccordionDetails>
    {providerExpanded[provider.name] && provider.inputs.map((inputParam, index) => (
        <Box key={index} sx={{ p: 2 }}>
            {/* ... */}
            {inputParam.type === 'credential' && (
                <CredentialInputHandler
                    key={`${provider.name}-${inputParam.name}`}  // âœ… æ·»åŠ ç¨³å®šçš„ key
                    data={analytic[provider.name] ? { credential: analytic[provider.name].credentialId } : {}}
                    inputParam={inputParam}
                    onSelect={(newValue) => setValue(newValue, provider.name, 'credentialId')}
                />
            )}
        </Box>
    ))}
</AccordionDetails>
```

**ä¿®å¤åŸç†ï¼š**
1. **æ¡ä»¶æ¸²æŸ“æå‡åˆ° map ä¹‹å‰**
   - åªæœ‰å±•å¼€çš„ Accordion æ‰æ¸²æŸ“è¾“å…¥ç»„ä»¶
   - æ€§èƒ½ä¼˜åŒ–ï¼šæŠ˜å çš„ Accordion ä¸ä¼šæ¸²æŸ“å†…éƒ¨ç»„ä»¶

2. **æ·»åŠ ç¨³å®šçš„ key**
   - `key={`${provider.name}-${inputParam.name}`}` ä¸ºæ¯ä¸ªç»„ä»¶æä¾›å”¯ä¸€æ ‡è¯†
   - React å¯ä»¥æ­£ç¡®è¿½è¸ªå’Œç®¡ç†æ¯ä¸ªç»„ä»¶å®ä¾‹
   - ç¡®ä¿æ•°æ®æ­£ç¡®å›æ˜¾

### ä¸ºä»€ä¹ˆéœ€è¦ç¨³å®šçš„ keyï¼Ÿ

**æ²¡æœ‰ key æ—¶ React çš„è¡Œä¸ºï¼š**
```javascript
// React æ— æ³•åŒºåˆ†è¿™äº›ç»„ä»¶
<CredentialInputHandler />  // è¿™æ˜¯å“ªä¸ªï¼Ÿ
<CredentialInputHandler />  // è¿™æ˜¯å“ªä¸ªï¼Ÿ
<CredentialInputHandler />  // è¿™æ˜¯å“ªä¸ªï¼Ÿ

// é‡æ–°æ¸²æŸ“æ—¶å¯èƒ½å¤ç”¨é”™è¯¯çš„ç»„ä»¶å®ä¾‹
// å¯¼è‡´çŠ¶æ€æ··ä¹±å’Œæ•°æ®å›æ˜¾é”™è¯¯
```

**æœ‰ç¨³å®š key æ—¶ React çš„è¡Œä¸ºï¼š**
```javascript
// React æ˜ç¡®çŸ¥é“æ¯ä¸ªç»„ä»¶çš„èº«ä»½
<CredentialInputHandler key="langSmith-credential" />   // LangSmith çš„å‡­è¯
<CredentialInputHandler key="langFuse-credential" />    // LangFuse çš„å‡­è¯
<CredentialInputHandler key="lunary-credential" />      // Lunary çš„å‡­è¯

// é‡æ–°æ¸²æŸ“æ—¶æ­£ç¡®å¤ç”¨å¯¹åº”çš„ç»„ä»¶å®ä¾‹
// çŠ¶æ€å’Œæ•°æ®ä¿æŒæ­£ç¡®
```

---

## âœ… ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰çš„æ‰§è¡Œæµç¨‹
```
1. ç”¨æˆ·å±•å¼€ LangSmith
   â†’ providerExpanded = { langSmith: true }
   
2. ç”¨æˆ·ç‚¹å‡»åˆ›å»ºå‡­è¯
   â†’ Redux çŠ¶æ€æ›´æ–°
   
3. dialogProps å¯¹è±¡å¼•ç”¨æ”¹å˜
   â†’ useEffect è¢«è§¦å‘
   
4. æ‰§è¡Œ cleanup å‡½æ•°
   â†’ setProviderExpanded({})
   â†’ providerExpanded = {}
   
5. Accordion æŠ˜å 
   â†’ providerExpanded[provider.name] = undefined
   
6. æ¡ä»¶æ¸²æŸ“å¤±è´¥
   â†’ undefined && <CredentialInputHandler /> = false
   
7. ç»„ä»¶å¸è½½
   â†’ CredentialInputHandler ä» DOM ç§»é™¤
   
8. å¯¹è¯æ¡†æ¶ˆå¤± âŒ
```

### ä¿®å¤åçš„æ‰§è¡Œæµç¨‹
```
1. ç”¨æˆ·å±•å¼€ LangSmith
   â†’ providerExpanded = { langSmith: true }
   
2. ç”¨æˆ·ç‚¹å‡»åˆ›å»ºå‡­è¯
   â†’ Redux çŠ¶æ€æ›´æ–°
   
3. dialogProps å¯¹è±¡å¼•ç”¨æ”¹å˜
   â†’ useEffect è¢«è§¦å‘
   
4. useEffect æ‰§è¡Œï¼ˆæ—  cleanupï¼‰
   â†’ providerExpanded ä¿æŒ { langSmith: true }
   
5. Accordion ä¿æŒå±•å¼€
   â†’ providerExpanded[provider.name] = true
   
6. æ¡ä»¶æ¸²æŸ“æˆåŠŸ
   â†’ true && <CredentialInputHandler /> = <CredentialInputHandler />
   
7. ç»„ä»¶ä¿æŒæŒ‚è½½
   â†’ CredentialInputHandler ç»§ç»­å­˜åœ¨
   
8. å¯¹è¯æ¡†æ­£å¸¸æ˜¾ç¤ºå’Œæ“ä½œ âœ…
   
9. ç”¨æˆ·é€‰æ‹©å‡­è¯å
   â†’ æ•°æ®æ­£ç¡®å›æ˜¾ âœ…
```

### åŠŸèƒ½éªŒè¯
- âœ… å¼¹çª—ä¸å†æ¶ˆå¤±
- âœ… å¯ä»¥æ­£å¸¸åˆ›å»ºå‡­è¯
- âœ… å‡­è¯æ•°æ®æ­£ç¡®å›æ˜¾
- âœ… Accordion çŠ¶æ€ä¿æŒç¨³å®š
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆåªæ¸²æŸ“å±•å¼€çš„å†…å®¹ï¼‰

---

## ğŸ“š çŸ¥è¯†ç‚¹æ€»ç»“

### 1. useEffect cleanup çš„ä½¿ç”¨æ—¶æœº
```javascript
useEffect(() => {
    // è®¾ç½®å‰¯ä½œç”¨
    const subscription = api.subscribe()
    
    return () => {
        // cleanup åº”è¯¥ç”¨äºï¼š
        // âœ… æ¸…ç†è®¢é˜…
        // âœ… æ¸…ç†å®šæ—¶å™¨
        // âœ… æ¸…ç†äº‹ä»¶ç›‘å¬
        // âœ… å–æ¶ˆç½‘ç»œè¯·æ±‚
        
        // âŒ ä¸åº”è¯¥ç”¨äºé‡ç½®ä¸ç›¸å…³çš„çŠ¶æ€
        subscription.unsubscribe()
    }
}, [ä¾èµ–é¡¹])
```

**æœ€ä½³å®è·µï¼š**
- Cleanup å‡½æ•°åº”è¯¥æ¸…ç†å½“å‰ effect åˆ›å»ºçš„èµ„æº
- ä¸è¦åœ¨ cleanup ä¸­é‡ç½®ä¸ç›¸å…³çš„ UI çŠ¶æ€
- è€ƒè™‘ cleanup æ‰§è¡Œçš„æ—¶æœºå’Œå½±å“

### 2. å¯¹è±¡ä½œä¸ºä¾èµ–é¡¹çš„é—®é¢˜
```javascript
// âŒ ä¸å¥½çš„åšæ³•
useEffect(() => {
    // props å¯¹è±¡å¼•ç”¨é¢‘ç¹æ”¹å˜
}, [props])

// âœ… å¥½çš„åšæ³• 1ï¼šåªä¾èµ–éœ€è¦çš„å±æ€§
useEffect(() => {
    // åªåœ¨ chatflow å®é™…æ”¹å˜æ—¶è§¦å‘
}, [dialogProps.chatflow])

// âœ… å¥½çš„åšæ³• 2ï¼šä½¿ç”¨ useMemo ç¨³å®šå¼•ç”¨
const stableProps = useMemo(() => dialogProps, [
    dialogProps.chatflow?.id,
    dialogProps.chatflow?.analytic
])
```

### 3. æ¡ä»¶æ¸²æŸ“çš„é€‰æ‹©
```javascript
// åœºæ™¯ 1ï¼šéœ€è¦ä¿æŒçŠ¶æ€ï¼Œåªæ˜¯éšè—
<div style={{ display: show ? 'block' : 'none' }}>
    <ExpensiveComponent />
</div>

// åœºæ™¯ 2ï¼šä¸éœ€è¦ä¿æŒçŠ¶æ€ï¼Œå¯ä»¥é”€æ¯é‡å»º
{show && <SimpleComponent />}

// åœºæ™¯ 3ï¼šæ€§èƒ½ä¼˜åŒ–ï¼Œä½†è¦ä¿æŒçŠ¶æ€
{show ? (
    <ExpensiveComponent />
) : (
    <Placeholder />  // å ä½ç¬¦ä¿æŒä½ç½®
)}
```

### 4. React key çš„é‡è¦æ€§
```javascript
// âŒ ä¸ç¨³å®šçš„ key
{items.map((item, index) => (
    <Component key={index} />  // index åœ¨æ’åºåä¼šæ”¹å˜
))}

// âœ… ç¨³å®šçš„ key
{items.map(item => (
    <Component key={item.id} />  // ä½¿ç”¨å”¯ä¸€ ID
))}

// âœ… ç»„åˆ key
<CredentialInputHandler 
    key={`${provider.name}-${inputParam.name}`}
/>
```

### 5. çŠ¶æ€ç®¡ç†çš„æœ€ä½³å®è·µ
```javascript
// âœ… çŠ¶æ€åº”è¯¥ï¼š
// 1. åªåœ¨å¿…è¦æ—¶æ›´æ–°
// 2. ç”±ç›´æ¥çš„ç”¨æˆ·æ“ä½œè§¦å‘
// 3. é¿å…å‰¯ä½œç”¨çš„çº§è”æ›´æ–°

const [expanded, setExpanded] = useState({})

// ç”±ç”¨æˆ·æ“ä½œç›´æ¥è§¦å‘
const handleAccordionChange = (name) => (event, isExpanded) => {
    setExpanded(prev => ({
        ...prev,
        [name]: isExpanded
    }))
}

// âŒ é¿å…åœ¨ä¸ç›¸å…³çš„ effect ä¸­é‡ç½®
useEffect(() => {
    // ...å…¶ä»–é€»è¾‘
    setExpanded({})  // ä¸å¥½ï¼
}, [someProps])
```

---

## ğŸ“ ç»™åˆå­¦è€…çš„å»ºè®®

### è°ƒè¯•æ­¤ç±»é—®é¢˜çš„æ–¹æ³•

1. **æ·»åŠ  console.log è¿½è¸ªçŠ¶æ€å˜åŒ–**
```javascript
useEffect(() => {
    console.log('dialogProps changed:', dialogProps)
    console.log('providerExpanded before:', providerExpanded)
    
    // ...é€»è¾‘ä»£ç 
    
    return () => {
        console.log('cleanup: resetting providerExpanded')
        setProviderExpanded({})
    }
}, [dialogProps])
```

2. **ä½¿ç”¨ React DevTools**
   - è§‚å¯Ÿç»„ä»¶çš„æŒ‚è½½/å¸è½½
   - æŸ¥çœ‹ props å’Œ state çš„å˜åŒ–
   - è¿½è¸ªé‡æ–°æ¸²æŸ“çš„åŸå› 

3. **ç†è§£ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**
   - ç»„ä»¶ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ
   - ç»„ä»¶ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“ï¼Ÿ
   - ç»„ä»¶ä»€ä¹ˆæ—¶å€™è¢«é”€æ¯ï¼Ÿ

4. **å¯¹æ¯”æ­£å¸¸å’Œå¼‚å¸¸çš„åœºæ™¯**
   - ä¸ºä»€ä¹ˆå·¥ä½œæµä¸­æ­£å¸¸ï¼Ÿ
   - æ™ºèƒ½ä½“ä¸­æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
   - æ‰¾å‡ºå·®å¼‚ç‚¹

### å­¦ä¹ èµ„æºæ¨è

- [React å®˜æ–¹æ–‡æ¡£ - useEffect](https://react.dev/reference/react/useEffect)
- [React å®˜æ–¹æ–‡æ¡£ - æ¡ä»¶æ¸²æŸ“](https://react.dev/learn/conditional-rendering)
- [React å®˜æ–¹æ–‡æ¡£ - åˆ—è¡¨ä¸ Key](https://react.dev/learn/rendering-lists)

---

## ğŸ“ å˜æ›´è®°å½•

| æ—¥æœŸ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹æ–‡ä»¶ |
|------|---------|---------|
| 2025-10-23 | ç§»é™¤è¿‡åº¦çš„ useEffect cleanup å‡½æ•° | `AnalyseFlow.jsx` |
| 2025-10-23 | ä¼˜åŒ–æ¡ä»¶æ¸²æŸ“ä½ç½® | `AnalyseFlow.jsx` |
| 2025-10-23 | ä¸º CredentialInputHandler æ·»åŠ ç¨³å®š key | `AnalyseFlow.jsx` |

---

## ğŸ”— ç›¸å…³é—®é¢˜

å¦‚æœå°†æ¥é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£çš„æ’æŸ¥æ€è·¯ï¼š
1. æ£€æŸ¥æ˜¯å¦æœ‰è¿‡åº¦çš„ cleanup å‡½æ•°
2. æ£€æŸ¥å¯¹è±¡å¼•ç”¨ä½œä¸ºä¾èµ–é¡¹çš„æƒ…å†µ
3. æ£€æŸ¥æ¡ä»¶æ¸²æŸ“å¯¼è‡´çš„ç»„ä»¶å¸è½½
4. ç¡®ä¿ç»„ä»¶æœ‰ç¨³å®šçš„ key

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š** 2025-10-23  
**Bug ä¿®å¤äººå‘˜ï¼š** AI Assistant  
**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** Development Team

