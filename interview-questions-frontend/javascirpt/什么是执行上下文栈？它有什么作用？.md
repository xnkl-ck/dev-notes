# **什么是执行上下文栈？它有什么作用？**

## 前言

执行上下文是理解 JavaScript 执行机制的关键概念，它决定了代码如何被解析和执行。执行上下文栈则描述了多个执行上下文的调用顺序和管理方式。掌握执行上下文栈的原理，有助于深入理解函数调用、作用域链、闭包、异步机制等，是面试中经常涉及的知识点。

## 执行上下文是什么

执行上下文（Execution Context）是 JavaScript 代码被执行时的环境抽象，它包含了变量环境、作用域链、this指向等关键信息。每当执行一段代码时，都会创建一个执行上下文。

执行上下文主要分为三种类型：

- 全局执行上下文：代码首次执行时创建，只有一个，全局作用域就在这里面
- 函数执行上下文：每次函数调用都会创建一个新的执行上下文
- eval执行上下文：执行eval代码时创建（较少使用）

执行上下文包括两个阶段：变量对象初始化阶段和代码执行阶段。

## 执行上下文栈的概念

执行上下文栈（Execution Context Stack），又称调用栈，是用来管理多个执行上下文的结构。当 JavaScript 引擎执行代码时，执行上下文会被压入栈中，当前栈顶的执行上下文就是正在执行的代码环境。

当函数调用时，会创建新的函数执行上下文并压入栈顶，执行结束后该上下文会被弹出，控制权回到下一个栈顶上下文。

这种栈结构保证了函数调用是先进后出（LIFO）的顺序。

## 具体执行流程举例

```plain
function first() {
  console.log('first');
  second();
}

function second() {
  console.log('second');
}

first();
```

执行过程：

1. 进入全局执行上下文，压入栈顶
2. 调用 `first()`，创建 `first` 函数执行上下文，压入栈顶
3. 执行 `console.log('first')`
4. 调用 `second()`，创建 `second` 函数执行上下文，压入栈顶
5. 执行 `console.log('second')`
6. `second` 执行完毕，弹出执行上下文
7. `first` 执行完毕，弹出执行上下文
8. 全局上下文继续执行或结束

## 执行上下文与作用域链的关系

每个执行上下文会创建自己的变量对象和作用域链，作用域链用于变量查找，而执行上下文则是管理代码执行的环境。

栈顶执行上下文决定当前代码执行的作用域，确保变量和函数访问的准确性。

## 面试回答

**问题：什么是执行上下文栈？它有什么作用？**

回答示范：

执行上下文栈是 JavaScript 引擎用来管理多个执行上下文的栈结构。当代码执行时，会先创建全局执行上下文压入栈顶，每当函数调用时会创建新的函数执行上下文并压入栈顶，执行结束后弹出。执行上下文栈保证了函数调用的顺序和作用域的准确管理。栈顶的执行上下文始终是当前正在执行的代码环境。理解执行上下文栈，有助于理解函数调用顺序、递归执行、以及调试过程。

## 总结

执行上下文栈是 JavaScript 执行机制的核心，负责管理代码执行环境和函数调用顺序。它与作用域链紧密结合，确保变量访问和 this 指向的准确。掌握执行上下文栈能够帮助你更好地理解 JS 代码的执行流程，并在面试中清晰表达相关概念。