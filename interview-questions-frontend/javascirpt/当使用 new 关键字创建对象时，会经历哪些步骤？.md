# **当使用 new 关键字创建对象时，会经历哪些步骤？**

## 前言

JavaScript 中，`new` 关键字是构造函数实例化对象的核心机制。了解 `new` 在幕后到底做了什么，有助于理解对象创建过程和原型链的形成，从而更好地掌握面向对象编程思想。本文将详细解析使用 `new` 创建对象时的具体步骤和原理。

## new 关键字创建对象的过程

使用 `new` 关键字执行构造函数时，JavaScript 引擎大致执行以下五个步骤：

1. **创建一个全新的空对象**
   新对象内部会有一个 `[[Prototype]]` 隐式属性（在 ES6+ 可通过 `__proto__` 访问），最初指向构造函数的 `prototype` 对象。
2. **将构造函数的** `**this**` **指向该新对象**
   使得构造函数内的属性和方法可以通过 `this` 添加到新对象上。
3. **执行构造函数中的代码**
   运行构造函数体，给新对象赋值属性或执行初始化逻辑。
4. **判断构造函数返回值**
   如果构造函数显式返回一个对象，则 `new` 表达式的结果是该对象；否则返回刚创建的新对象。
5. **返回最终对象**
   返回上述得到的对象给调用者。

## 例子演示

```plain
function Person(name) {
  this.name = name;
  // return { age: 18 }; // 如果返回对象，这个对象会被返回而非 this
}
const p = new Person('Alice');
console.log(p.name); // Alice
```

如果构造函数中返回了一个对象，`new` 返回的就是该对象，而非新建的那个。

## 原型链的形成

在第一步中，新建对象的 `[[Prototype]]` 被指向构造函数的 `prototype` 属性。这样新对象就继承了构造函数原型上的属性和方法，形成原型链。

```plain
Person.prototype.say = function() {
  console.log('Hello, ' + this.name);
};
p.say(); // Hello, Alice
```

## 需要注意的细节

- 构造函数不返回对象时，`new` 自动返回新对象。
- 构造函数返回非对象类型值（如基本类型），则忽略该返回值，依然返回新对象。
- ES6 `class` 的实例化过程本质上也遵循这套流程。

------

## 面试回答示范

**问题：当使用** `**new**` **关键字创建对象时，会经历哪些步骤？**

回答示例：

“`new` 操作符执行时，首先创建一个新的空对象，设置其原型指向构造函数的 `prototype`。然后把构造函数内部的 `this` 绑定到该对象，执行构造函数代码。接着判断构造函数返回值，如果返回的是对象，则返回该对象，否则返回新创建的对象。最后返回结果。”

------

## 总结

理解 `new` 的工作机制，有助于把握 JavaScript 对象创建、继承和原型链的核心原理，提升面向对象编程能力。它是连接函数与对象的关键桥梁，也是理解 ES6 class 实现的基础。