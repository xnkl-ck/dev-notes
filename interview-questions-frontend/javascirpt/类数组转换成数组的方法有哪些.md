# **类数组转换成数组的方法有哪些**

## 前言

在 JavaScript 中，我们经常会遇到“类数组”的数据结构，比如 `arguments` 对象、DOM 查询结果 `NodeList` 等。这些对象虽然具有 `length` 和数字索引的特性，但并不是真正的数组，因此不能直接使用数组方法。这时，掌握如何将类数组转换成真正的数组就变得非常重要，尤其是在数据处理或遍历需求频繁的前端开发中。

## 为什么需要转换类数组

虽然类数组具有数组的结构特征，但它们无法直接使用数组的原型方法，比如 `map`、`filter`、`reduce` 等。直接调用这些方法会报错或行为异常。将其转换为数组可以解锁所有数组的能力，使代码更加简洁、高效、易维护。

以 `arguments` 为例：

```plain
function test() {
  arguments.map(item => console.log(item)); // TypeError: arguments.map is not a function
}
```

如果先转换为数组：

```plain
function test() {
  const args = Array.from(arguments);
  args.map(item => console.log(item)); // OK
}
```

## 常见的转换方法

### 1. Array.from

这是最推荐也是最现代的方式，语义清晰、兼容性好（ES6 及以上）：

```plain
const arrayLike = { 0: 'a', 1: 'b', length: 2 };
const result = Array.from(arrayLike); // ['a', 'b']
```

还可以传入 map 函数作为第二个参数：

```plain
Array.from(arrayLike, item => item.toUpperCase());
```

### 2. 扩展运算符（Spread Operator）

适用于可迭代的类数组对象，如字符串、NodeList、arguments：

```plain
const args = [...arguments];
const nodes = [...document.querySelectorAll('div')];
```

注意：并非所有类数组都可用扩展运算符，如非迭代对象会抛错。

### 3. Array.prototype.slice.call

这是最经典的兼容方式，在老项目或 ES5 中经常使用：

```plain
function test() {
  const args = Array.prototype.slice.call(arguments);
}
```

本质上是借用数组的方法对类数组进行转换。

### 4. [].slice.call 的简写形式

可以简化写法如下：

```plain
const arr = [].slice.call(arguments);
```

虽然简洁，但语义不如 `Array.prototype.slice.call` 清晰。

### 5. 使用 Array 构造函数加 map 手动转换

如果类数组可遍历，可以使用 `Array(length).fill().map()` 构造：

```plain
const arrayLike = { 0: 'x', 1: 'y', length: 2 };
const result = Array.from({ length: arrayLike.length }, (_, i) => arrayLike[i]);
```

这个方法虽然灵活，但略显冗长。

## 哪些类数组不能直接用扩展运算符

需要注意，扩展运算符只能作用于**可迭代对象**（具备 `[Symbol.iterator]` 方法），而一些类数组对象如：

- `arguments`（在非严格模式下）
- 自定义对象 `{ 0: 'a', 1: 'b', length: 2 }`

这些默认并不具备迭代器，因此不能直接用 `...` 解构，需要使用 `Array.from` 或 `slice`。

## 面试回答

**问题：请问你了解哪些方式可以把类数组转换成真正的数组？**

回答示范（口语化）：

这个问题我在实际开发中遇到过不少，像 `arguments`、DOM 的 NodeList 都是类数组，不能直接用 `map` 或 `filter`，所以转换就特别关键。

我平时主要用三种方式：

第一种是 `Array.from()`，这个是最推荐的，写法简单而且语义很清晰。只要是带 `length` 和数字索引的对象，基本都能转。

第二种是扩展运算符，也就是 `[...xxx]`，这种写法特别适合处理 DOM 节点集合或者 `arguments`。不过它只适用于可迭代对象，比如 `NodeList` 可以，纯粹的对象就不行。

第三种是老的写法，用 `Array.prototype.slice.call()`，这个我在一些兼容老浏览器的项目中还用过，转换能力也很强，缺点是写法不够现代。

我平时选用哪个方式，主要看对象是不是可迭代，还有当前项目是不是可以使用 ES6 语法。如果项目支持现代写法，那基本上就用 `Array.from` 或 `...`。

## 总结

将类数组转换为真正数组，是 JavaScript 开发中非常实用的基本技能。掌握 `Array.from`、扩展运算符、`slice.call` 等主流方法，能够帮助我们更灵活、高效地处理函数参数、DOM 结构等场景。面对不同浏览器支持和代码风格选择，合理地选用合适的方式，不仅能提升代码质量，也能展现专业素养。